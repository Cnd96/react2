{"version":3,"file":"field-editor-test-utils.cjs.production.min.js","sources":["../src/createFakeFieldAPI.ts","../src/createFakeLocalesAPI.ts","../src/fakesFactory.ts","../src/createFakeSpaceAPI.ts","../src/ActionsPlayground.tsx","../src/createFakeNavigatorAPI.ts"],"sourcesContent":["import mitt from 'mitt';\nimport type { Emitter, Handler } from 'mitt';\nimport { FieldAPI } from '@contentful/app-sdk';\n\nfunction identity<T>(item: T): T {\n  return item;\n}\n\ntype CustomizeMockFn = (fieldApi: FieldAPI) => FieldAPI;\n\nexport function createFakeFieldAPI<T>(\n  customizeMock: CustomizeMockFn = identity,\n  initialValue?: T\n): [FieldAPI, Emitter] {\n  const emitter: Emitter = mitt();\n\n  // eslint-disable-next-line\n  let _value: any = initialValue;\n\n  return [\n    customizeMock({\n      id: 'fake-id',\n      locale: 'en-US',\n      type: 'Symbol',\n      validations: [],\n      required: false,\n      onValueChanged: (...args: [string, Function] | [Function]) => {\n        let fn: Function;\n        if (typeof args[0] === 'string') {\n          fn = args[1] as Function;\n        } else {\n          fn = args[0];\n        }\n        emitter.on('onValueChanged', fn as Handler);\n        return () => {\n          emitter.off('onValueChanged', fn as Handler);\n        };\n      },\n      onIsDisabledChanged: (fn: Function) => {\n        emitter.on('onIsDisabledChanged', fn as Handler);\n        return () => {\n          emitter.off('onIsDisabledChanged', fn as Handler);\n        };\n      },\n      onSchemaErrorsChanged: (fn: Function) => {\n        emitter.on('onSchemaErrorsChanged', fn as Handler);\n        return () => {\n          emitter.off('onSchemaErrorsChanged', fn as Handler);\n        };\n      },\n      getValue: () => {\n        emitter.emit('getValue');\n        return _value;\n      },\n      setInvalid: () => {\n        emitter.emit('setInvalid');\n      },\n      setValue: (value: string) => {\n        _value = value;\n        emitter.emit('setValue', _value);\n        emitter.emit('onValueChanged', _value);\n        return Promise.resolve();\n      },\n      removeValue: () => {\n        _value = undefined;\n        emitter.emit('removeValue');\n        emitter.emit('onValueChanged', undefined);\n        return Promise.resolve();\n      },\n    }),\n    emitter,\n  ];\n}\n","import { LocalesAPI } from '@contentful/app-sdk';\n\nfunction identity<T>(item: T): T {\n  return item;\n}\n\ntype CustomizeMockFn = (fieldApi: LocalesAPI) => LocalesAPI;\n\nexport function createFakeLocalesAPI(customizeMock: CustomizeMockFn = identity): LocalesAPI {\n  return customizeMock(({\n    default: 'en-US',\n    available: ['en-US'],\n    fallbacks: {\n      'en-US': undefined,\n    },\n    names: {\n      'en-US': 'English',\n    },\n    optional: {\n      'en-US': false,\n    },\n    direction: {\n      'en-US': 'ltr',\n    },\n  } as unknown) as LocalesAPI);\n}\n","import { Entry } from '@contentful/field-editor-shared';\n\ninterface Fields {\n  [key: string]: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    [localeKey: string]: any;\n  };\n}\n\nexport const createEntry = (contentTypeId: string, fields: Fields): Entry => ({\n  fields,\n  sys: {\n    id: `entry-${Math.round(Math.random() * 1000)}`,\n    type: 'Entry',\n    space: { sys: { id: 'space', type: 'Link', linkType: 'Space' } },\n    environment: { sys: { id: 'e123', type: 'Link', linkType: 'Environment' } },\n    version: 2,\n    publishedVersion: 2,\n    publishedCounter: 1,\n    createdAt: '2020-02-15T17:41:01.000Z',\n    updatedAt: '2020-02-17T20:20:01.000Z',\n    publishedAt: '2020-02-18T17:41:01.000Z',\n    firstPublishedAt: '2020-02-18T17:41:01.000Z',\n    createdBy: { sys: { id: 'u123', type: 'Link', linkType: 'User' } },\n    updatedBy: { sys: { id: 'u123', type: 'Link', linkType: 'User' } },\n    publishedBy: { sys: { id: 'u123', type: 'Link', linkType: 'User' } },\n    contentType: { sys: { id: contentTypeId, type: 'Link', linkType: 'ContentType' } },\n  },\n  metadata: {\n    tags: [],\n  },\n});\n","import { ContentType, SearchQuery, SpaceAPI } from '@contentful/app-sdk';\nimport { Entry } from '@contentful/field-editor-shared';\nimport { createEntry } from './fakesFactory';\n\nfunction identity<T>(item: T): T {\n  return item;\n}\n\ntype CustomizeMockFn = (api: SpaceAPI) => SpaceAPI;\n\nconst testContentTypes: ContentType[] = [\n  {\n    name: 'Example Content Type',\n    sys: { id: 'exampleCT', type: 'ContentType' },\n    fields: [\n      {\n        id: 'exField',\n        disabled: false,\n        localized: false,\n        name: 'Example Field',\n        omitted: false,\n        required: true,\n        type: 'Symbol',\n        validations: [],\n      },\n      {\n        id: 'exDesc',\n        disabled: false,\n        localized: false,\n        name: 'Description Field',\n        omitted: false,\n        required: false,\n        type: 'Text',\n        validations: [],\n      },\n    ],\n    displayField: 'exField',\n    description: '',\n  },\n  {\n    name: 'Another Content Type',\n    sys: { id: 'anotherCT', type: 'ContentType' },\n    fields: [],\n    displayField: '',\n    description: '',\n  },\n];\n\nexport function createFakeSpaceAPI(customizeMock: CustomizeMockFn = identity): SpaceAPI {\n  return customizeMock(({\n    getCachedContentTypes() {\n      return testContentTypes;\n    },\n    getContentTypes() {\n      return Promise.resolve({\n        items: testContentTypes,\n        total: testContentTypes.length,\n        skip: 0,\n        limit: 100,\n        sys: { type: 'Array' },\n      });\n    },\n    getEntries(query?: SearchQuery) {\n      const items: Entry[] = [\n        createEntry('exampleCT', { exField: { 'en-US': 'Hello world' } }),\n        createEntry('exampleCT', {}),\n      ];\n      return Promise.resolve({\n        items: !query || query.content_type === 'exampleCT' ? items : [],\n        total: items.length,\n        skip: 0,\n        limit: 100,\n        sys: { type: 'Array' },\n      });\n    },\n    getAssets() {\n      return Promise.resolve({\n        items: [],\n        total: 0,\n        skip: 0,\n        limit: 100,\n        sys: { type: 'Array' },\n      });\n    },\n    createEntry(contentTypeId: string) {\n      return Promise.resolve(createEntry(contentTypeId, {}));\n    },\n    createAsset() {\n      return Promise.resolve({});\n    },\n  } as unknown) as SpaceAPI);\n}\n","import React from 'react';\nimport type { Emitter } from 'mitt';\nimport { css } from 'emotion';\nimport tokens from '@contentful/forma-36-tokens';\n\ntype EventDefinition = { type?: string; value: any; id: number };\n\ntype ActionsPlaygroundProps = {\n  mitt: Emitter;\n  renderValue: Function;\n};\n\ntype ActionPlaygroundState = {\n  events: EventDefinition[];\n};\n\ntype AddActions = { type: 'add'; payload: { type?: string; value: any } };\ntype Actions = AddActions;\n\nfunction reducer(state: ActionPlaygroundState, action: Actions): ActionPlaygroundState {\n  if (action.type === 'add') {\n    return {\n      ...state,\n      events: [\n        {\n          id: state.events.length + 1,\n          type: action.payload.type,\n          value: action.payload.value,\n        },\n        ...state.events,\n      ],\n    };\n  }\n  return state;\n}\n\nfunction ActionsPlayground(props: ActionsPlaygroundProps) {\n  const [state, dispatch] = React.useReducer(reducer, { events: [] });\n\n  const onLog = (type?: string, event?: any) => {\n    dispatch({\n      type: 'add',\n      payload: {\n        type,\n        value: event,\n      },\n    });\n  };\n\n  React.useEffect(() => {\n    props.mitt.on('*', onLog);\n\n    if ((window as any).Cypress) {\n      (window as any).editorEvents = [];\n      (window as any).setValueExternal = (value: any) => {\n        props.mitt.emit('onValueChanged', value);\n      };\n    }\n\n    return () => {\n      props.mitt.off('*', onLog);\n      (window as any).editorEvents = undefined;\n      (window as any).setValueExternal = undefined;\n    };\n  }, [props.mitt]);\n\n  React.useEffect(() => {\n    (window as any).editorEvents = [...state.events];\n  }, [props, state.events]);\n\n  return (\n    <div\n      className={css({\n        border: `1px solid ${tokens.colorElementLight}`,\n        padding: tokens.spacingS,\n        marginTop: tokens.spacingXl,\n      })}>\n      <div\n        className={css({\n          height: 150,\n          overflowY: 'scroll',\n          fontSize: tokens.fontSizeM,\n        })}>\n        {state.events.map((log) => (\n          <div key={log.id}>\n            <div>\n              <code>\n                {log.id}. {log.type}\n              </code>\n            </div>\n            <div>{log.value ? props.renderValue(log.value, log.type) : <pre>undefined</pre>}</div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nActionsPlayground.defaultProps = {\n  renderValue: function JsonStringifiedValue(value: any) {\n    return <pre>{JSON.stringify(value, null, 2)}</pre>;\n  },\n};\n\nexport { ActionsPlayground };\n","export function createFakeNavigatorAPI() {\n  return {\n    openEntry(entryId: string) {\n      window.alert(`Open entry ${entryId}`);\n    },\n    openAsset(assetId: string) {\n      window.alert(`Open asset ${assetId}`);\n    }\n  };\n}\n"],"names":["identity","item","createEntry","contentTypeId","fields","sys","id","Math","round","random","type","space","linkType","environment","version","publishedVersion","publishedCounter","createdAt","updatedAt","publishedAt","firstPublishedAt","createdBy","updatedBy","publishedBy","contentType","metadata","tags","testContentTypes","name","disabled","localized","omitted","required","validations","displayField","description","reducer","state","action","events","length","payload","value","ActionsPlayground","props","React","useReducer","dispatch","onLog","event","useEffect","mitt","on","window","Cypress","editorEvents","setValueExternal","emit","off","undefined","className","css","border","tokens","colorElementLight","padding","spacingS","marginTop","spacingXl","height","overflowY","fontSize","fontSizeM","map","log","key","renderValue","defaultProps","JSON","stringify","customizeMock","initialValue","emitter","_value","locale","onValueChanged","fn","onIsDisabledChanged","onSchemaErrorsChanged","getValue","setInvalid","setValue","Promise","resolve","removeValue","available","fallbacks","names","optional","direction","openEntry","entryId","alert","openAsset","assetId","getCachedContentTypes","getContentTypes","items","total","skip","limit","getEntries","query","exField","content_type","getAssets","createAsset"],"mappings":"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"}