"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("@contentful/forma-36-react-components"),i=require("emotion"),s=e(require("@contentful/forma-36-tokens")),o=e(require("lodash/get")),a=e(require("moment")),c=e(require("deep-equal")),l=require("@contentful/field-editor-shared"),u=e(require("constate")),d=e(require("lodash/isNumber")),p=e(require("array-move")),f=require("react-sortable-hoc"),y=e(require("@contentful/mimetype"));function m(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){m(s,r,i,o,a,"next",e)}function a(e){m(s,r,i,o,a,"throw",e)}o(void 0)}))}}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var g=i.css({display:"flex",border:"1px dashed "+s.gray500,borderRadius:s.borderRadiusMedium,justifyContent:"center",padding:s.spacingXl}),E=i.css({textDecoration:"none",fontWeight:"bold"}),b={wrapper:i.css({position:"relative"}),searchInput:function(e){return i.css({"& > input":{borderColor:"transparent",borderRadius:e?0:void 0,borderLeft:e?"none":void 0,borderRight:e?"none":void 0,paddingRight:s.spacing2Xl,"::placeholder":{color:s.gray600}}})},searchIcon:i.css({position:"absolute",right:s.spacingM,top:s.spacingS,zIndex:Number(s.zIndexDefault),fill:s.gray600}),separator:i.css({background:s.gray200,margin:"10px 0"}),dropdownList:i.css({borderColor:s.gray200})},C=function(e){var i=e.contentTypes,s=e.suggestedContentTypeId,a=e.contentTypesLabel,c=e.onSelect,l=e.testId,u=e.dropdownSettings,d=void 0===u?{position:"bottom-left"}:u,p=e.renderCustomDropdownItems,f=e.children,y=t.useState(!1),m=y[0],v=y[1],h=t.useState(!1),g=h[0],E=h[1],C=t.useState(""),k=C[0],w=C[1],x=t.useRef(null),T=t.useRef(null),L=t.useRef(null),I=t.useState(0),D=I[0],A=I[1],S=i.length>1||!!p,M=function(){return v(!1)};t.useEffect((function(){m&&setTimeout((function(){var e,t;null==T||null==(e=T.current)||null==(t=e.querySelector("input"))||t.focus()}),200)}),[m]);var O,N=function(e){M();var t=c(e.sys.id);t&&"function"==typeof t.then&&(E(!0),t.then((function(){return E(!1)}),(function(){return E(!1)})))},P=t.useCallback((function(e){x&&x.current&&L&&L.current&&!x.current.contains(e.target)&&!L.current.contains(e.target)&&M()}),[x]);t.useEffect((function(){return document.addEventListener("mouseup",O),function(){return document.removeEventListener("mouseup",O)}}),[O=P]),t.useEffect((function(){m||w("")}),[m]);var R,j=i.length>20,_=s?300:250,H=i.find((function(e){return e.sys.id===s})),F=i.filter((function(e){return!k||o(e,"name","Untitled").toLowerCase().includes(k.toLowerCase())}));return n.createElement("span",{className:b.wrapper,ref:x,"data-test-id":l},n.createElement(r.Dropdown,{focusContainerOnOpen:!1,position:d.position,isAutoalignmentEnabled:d.isAutoalignmentEnabled,isOpen:m&&S,toggleElement:f({isOpen:m,isSelecting:g,openMenu:function(){S?v(!m):N(i[0])}}),testId:"add-entry-menu",getContainerRef:function(e){L.current=e,!D&&e&&A(e.clientWidth)}},p&&n.createElement(r.DropdownList,{className:b.dropdownList,border:"top"},p({closeMenu:M})),j&&n.createElement("div",{ref:T,className:b.wrapper},n.createElement(r.TextInput,{className:b.searchInput(S),placeholder:"Search all content types",testId:"add-entry-menu-search",value:k,onChange:function(e){return w(e.target.value)}}),n.createElement(r.Icon,{icon:"Search",className:b.searchIcon})),n.createElement(r.DropdownList,{className:b.dropdownList,border:"top",styles:{width:D||"",maxHeight:_},maxHeight:_},k&&((R=F.length)?n.createElement(r.DropdownListItem,{isTitle:!0,testId:"add-entru-menu-search-results"},R," result",R>1?"s":""):null),H&&!k&&n.createElement(n.Fragment,null,n.createElement(r.DropdownListItem,{isTitle:!0},"Suggested Content Type"),n.createElement(r.DropdownListItem,{testId:"suggested",onClick:function(){return N(H)}},o(H,"name")),n.createElement("hr",{className:b.separator})),!k&&n.createElement(r.DropdownListItem,{isTitle:!0},a),F.length?F.map((function(e,t){return n.createElement(r.DropdownListItem,{testId:"contentType",key:o(e,"name")+"-"+t,onClick:function(){return N(e)}},o(e,"name","Untitled"))})):n.createElement(r.DropdownListItem,{testId:"add-entru-menu-search-results"},"No results found"))))};C.defaultProps={testId:"create-entry-button-menu-trigger",contentTypesLabel:"All Content Types"};var k={spinnerMargin:i.css({marginRight:s.spacingXs}),action:void 0},w=h({},k,{action:i.css({textDecoration:"none",fontWeight:"bold"})}),x=function(e){var t=e.contentTypes,i=e.onSelect,s=e.renderCustomDropdownItems,a=e.text,c=e.testId,l=e.hasPlusIcon,u=void 0!==l&&l,d=e.useExperimentalStyles,p=e.suggestedContentTypeId,f=e.dropdownSettings,y=e.disabled,m=void 0!==y&&y,v=t.find((function(e){return e.sys.id===p})),h=a||"Add "+o(v||(1===t.length?t[0]:{}),"name","entry"),g=t.length>1||s,E=u?"Plus":void 0,b=d?w:k;return n.createElement(C,{contentTypes:t,suggestedContentTypeId:p,contentTypesLabel:d?"New content":void 0,onSelect:i,testId:c,dropdownSettings:f,renderCustomDropdownItems:s},(function(e){var i=e.openMenu,s=e.isSelecting;return n.createElement(n.Fragment,null,s&&n.createElement(r.Spinner,{size:"small",key:"spinner",className:b.spinnerMargin}),n.createElement(r.Button,{buttonType:"muted",onClick:function(){i()},className:b.action,disabled:m||s||t&&0===t.length,icon:s?void 0:E,indicateDropdown:Boolean(g),size:"small",testId:"create-entry-link-button"},h))}))},T=i.css({display:"flex",width:"100%",marginTop:s.spacingS}),L=i.css({marginRight:s.spacingXl});function I(){return n.createElement(r.Paragraph,null,"You don't have permission to view this content or this field is not correctly configured. Contact your administrator for help.")}var D={createNew:function(e){return null!=e&&e.contentType?"Create new "+e.contentType+" and link":"Create new entry and link"},linkExisting:function(e){return null!=e&&e.canLinkMultiple?"Link existing entries":"Link existing entry"}},A={createNew:function(){return"Create new asset and link"},linkExisting:function(e){return null!=e&&e.canLinkMultiple?"Link existing assets":"Link existing asset"}},S={dropdown:"linkEditor.dropdown",createAndLink:"linkEditor.createAndLink",createAndLinkWrapper:"create-entry-button-menu-trigger",linkExisting:"linkEditor.linkExisting"};function M(e){if(e.isFull)return null;var n=h({},"Entry"===e.entityType?D:A,e.actionLabels);return t.createElement("div",{className:T},e.canCreateEntity&&t.createElement(t.Fragment,null,"Entry"===e.entityType&&t.createElement(x,{testId:S.createAndLink,disabled:e.isDisabled,text:n.createNew({contentType:1===e.contentTypes.length?e.contentTypes[0].name:void 0}),contentTypes:e.contentTypes,hasPlusIcon:!0,onSelect:function(t){return t?e.onCreate(t,e.itemsLength):Promise.resolve()}}),"Asset"===e.entityType&&t.createElement(r.Button,{disabled:e.isDisabled,testId:S.createAndLink,onClick:function(){e.onCreate(void 0,e.itemsLength)},buttonType:"muted",icon:"Plus",size:"small"},n.createNew()),t.createElement("span",{className:L})),e.canLinkEntity&&t.createElement(r.Button,{disabled:e.isDisabled,testId:S.linkExisting,onClick:function(){e.onLinkExisting()},buttonType:"muted",icon:"Link",size:"small"},n.linkExisting({canLinkMultiple:e.canLinkMultiple})),!e.canCreateEntity&&!e.canLinkEntity&&t.createElement(I,null))}var O=h({},S,{actionsWrapper:"link-actions-menu-trigger"});function N(e){return e.canCreateEntity?t.createElement(x,{testId:O.actionsWrapper,disabled:e.isDisabled,text:e.combinedActionsLabel||"Add content",contentTypes:e.contentTypes,hasPlusIcon:!0,useExperimentalStyles:!0,dropdownSettings:{position:"bottom-left"},onSelect:function(t){return t?e.onCreate(t):Promise.resolve()},renderCustomDropdownItems:e.canLinkEntity?function(n){var i=n.closeMenu;return t.createElement(r.DropdownListItem,{testId:O.linkExisting,onClick:function(){i(),e.onLinkExisting()}},"Add existing content")}:void 0}):e.canLinkEntity?t.createElement(r.Button,{disabled:e.isDisabled,testId:O.linkExisting,className:E,onClick:function(){e.onLinkExisting()},buttonType:"muted",icon:"Link",size:"small"},"Add existing content"):null}function P(e){var n=t.useState(!1),i=n[0],s=n[1];return e.canLinkEntity&&e.canCreateEntity?t.createElement(r.Dropdown,{isOpen:i,onClose:function(){return s(!1)},toggleElement:t.createElement(t.Fragment,null,t.createElement(r.Button,{disabled:e.isDisabled,testId:O.actionsWrapper,className:E,onClick:function(){s(!i)},buttonType:"muted",icon:"Plus",indicateDropdown:!0,size:"small"},"Add media"))},t.createElement(r.DropdownList,{testId:O.dropdown},t.createElement(r.DropdownListItem,{testId:O.linkExisting,onClick:function(){s(!1),e.onLinkExisting()}},"Add existing media"),t.createElement(r.DropdownListItem,{testId:O.createAndLink,onClick:function(){s(!1),e.onCreate()}},"Add new media"))):e.canLinkEntity?t.createElement(r.Button,{disabled:e.isDisabled,testId:O.linkExisting,className:E,onClick:function(){e.onLinkExisting()},buttonType:"muted",icon:"Plus",size:"small"},"Add existing media"):e.canCreateEntity?t.createElement(r.Button,{disabled:e.isDisabled,testId:O.createAndLink,className:E,onClick:function(){e.onCreate()},buttonType:"muted",icon:"Plus",size:"small"},"Add media"):null}var R=i.css({position:"relative"}),j=i.css({display:"flex",alignItems:"center",width:"135px",height:"160px",textAlign:"center"}),_=i.css({position:"absolute",top:s.spacingS,right:s.spacingS});function H(e){return n.createElement(r.Card,{className:R},n.createElement("div",{className:e.asSquare?j:""},n.createElement(r.SectionHeading,null,"Entry"===e.entityType&&"Entry is missing or inaccessible","Asset"===e.entityType&&"Asset is missing or inaccessible")),!e.isDisabled&&e.onRemove&&n.createElement(r.IconButton,{className:_,buttonType:"muted",label:"Delete",iconProps:{icon:"Close"},onClick:function(){e.onRemove&&e.onRemove()}}))}function F(e,t){return e(t={exports:{}},t.exports),t.exports}var z=F((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof d?t:d).prototype),s=new w(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return{value:void 0,done:!0}}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=b(o,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,s),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function p(){}function f(){}var y={};y[i]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(x([])));v&&v!==t&&n.call(v,i)&&(y=v);var h=f.prototype=d.prototype=Object.create(y);function g(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var r;this._invoke=function(i,s){function o(){return new t((function(r,o){!function r(i,s,o,a){var c=l(e[i],e,s);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,a)}),(function(e){r("throw",e,o,a)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,a)}))}a(c.arg)}(i,s,r,o)}))}return r=r?r.then(o,o):o()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=h.constructor=f,f.constructor=p,p.displayName=a(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},g(E.prototype),E.prototype[s]=function(){return this},e.AsyncIterator=E,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new E(c(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(h),a(h,o,"Generator"),h[i]=function(){return this},h.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(a&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),B=function(e){return e.map((function(e){return e.sys.id}))};function Y(e){return q.apply(this,arguments)}function q(){return(q=v(z.mark((function e(t){var n,r;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Entry"!==t.entityType){e.next=11;break}if(t.contentTypeId){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,t.sdk.navigator.openNewEntry(t.contentTypeId,{slideIn:!0});case 5:return e.abrupt("return",{entity:(n=e.sent).entity,slide:n.slide});case 11:return e.next=13,t.sdk.navigator.openNewAsset({slideIn:!0});case 13:return e.abrupt("return",{entity:(r=e.sent).entity,slide:r.slide});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return G.apply(this,arguments)}function G(){return(G=v(z.mark((function e(t){return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Entry"!==t.entityType){e.next=6;break}return e.next=3,t.sdk.dialogs.selectSingleEntry({locale:t.sdk.field.locale,contentTypes:B(t.editorPermissions.readableContentTypes)});case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",t.sdk.dialogs.selectSingleAsset({locale:t.sdk.field.locale,mimetypeGroups:t.editorPermissions.validations.mimetypeGroups}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return W.apply(this,arguments)}function W(){return(W=v(z.mark((function e(t){var n,r,i,s,o,a;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.sdk.field.getValue(),s=Array.isArray(i)?i.length:i?1:0,o=Math.max(((null==(n=t.editorPermissions.validations.numberOfLinks)?void 0:n.min)||1)-s,1),a=((null==(r=t.editorPermissions.validations.numberOfLinks)?void 0:r.max)||Infinity)-s,"Entry"!==t.entityType){e.next=10;break}return e.next=7,t.sdk.dialogs.selectMultipleEntries({locale:t.sdk.field.locale,contentTypes:B(t.editorPermissions.readableContentTypes),min:o,max:a});case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",t.sdk.dialogs.selectMultipleAssets({locale:t.sdk.field.locale,mimetypeGroups:t.editorPermissions.validations.mimetypeGroups,min:o,max:a}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=["renderCustomActions"];function J(e){var n,r=e.sdk,i=e.editorPermissions,s=e.entityType,o=e.canLinkMultiple,a=e.isDisabled,c=e.actionLabels,l=e.itemsLength,u=null==(n=i.validations.numberOfLinks)?void 0:n.max,d=r.field.getValue(),p=Array.isArray(d)?d.length:d?1:0,f=!!u&&u<=p,y=0===p,m=t.useCallback((function(t,n,r){void 0===n&&(n=l),e.onCreate(t.sys.id,n),e.onAction&&e.onAction({type:"create_and_link",entity:s,entityData:t,slide:r,index:n})}),[s,e.onCreate,e.onAction]),h=t.useCallback((function(t,n){void 0===n&&(n=l),e.onLink(t.map((function(e){return e.sys.id})),n),t.forEach((function(t,r){e.onAction&&e.onAction({type:"select_and_link",entity:s,entityData:t,index:void 0===n?void 0:n+r})}))}),[s,e.onLink,e.onAction]),g=t.useCallback(function(){var e=v(z.mark((function e(t,n){var i,o,a;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({sdk:r,entityType:s,contentTypeId:t});case 2:if(a=(i=e.sent).slide,o=i.entity){e.next=7;break}return e.abrupt("return");case 7:m(o,n,a);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[r,s,m]),E=t.useCallback(function(){var e=v(z.mark((function e(t){var n;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U({sdk:r,entityType:s,editorPermissions:i});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:h([n],t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,s,h]),b=t.useCallback(function(){var e=v(z.mark((function e(t){var n;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({sdk:r,entityType:s,editorPermissions:i});case 2:if((n=e.sent)&&0!==n.length){e.next=5;break}return e.abrupt("return");case 5:h(n,t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,s,h]);return t.useMemo((function(){return{entityType:s,canLinkMultiple:o,isDisabled:a,isEmpty:y,isFull:f,canCreateEntity:i.canCreateEntity,canLinkEntity:i.canLinkEntity,contentTypes:i.creatableContentTypes,onCreate:g,onLinkExisting:o?b:E,actionLabels:c,onCreated:m,onLinkedExisting:h,itemsLength:l}}),[s,o,a,y,f,i.canCreateEntity,i.canLinkEntity,c,i.creatableContentTypes.map((function(e){return e.sys.id})).join(":"),g,E,b,m,h,l])}function K(e){return(e.renderCustomActions||function(e){return t.createElement(M,Object.assign({},e))})(function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)t.indexOf(n=s[r])>=0||(i[n]=e[n]);return i}(e,X))}var Q={statusTag:i.css({marginLeft:s.spacingM,zIndex:"0 !important"}),positiveColor:i.css({color:s.colorPositive}),secondaryColor:i.css({color:s.gray500}),marginRightXS:i.css({marginRight:s.spacing2Xs}),paragraph:i.css({textAlign:"center",color:s.gray500}),time:i.css({color:s.gray200})},Z=function(e){var t,s=e.job,o=e.jobsCount,c="";switch(s.action.toLowerCase()){case"publish":c=Q.positiveColor;break;case"unpublish":c=Q.secondaryColor;break;default:c=Q.secondaryColor}return n.createElement(n.Fragment,null,n.createElement("span",{className:Q.time,"data-test-id":"cf-scheduled-time-tootlip-content"},function(e,t){switch(a().startOf("day").diff(a(e).startOf("day"),"days")){case 0:return"Today, "+a(e).format("DD MMM YYYY");case-1:return"Tomorrow, "+a(e).format("DD MMM YYYY");case 1:return"Yesterday, "+a(e).format("DD MMM YYYY");default:return a(e).format("ddd, DD MMM YYYY")}}(t=s.scheduledFor.datetime)+" at "+function(e){return a.utc(e).local().format("h:mm A")}(t)),n.createElement(r.Tag,{tagType:"publish"===s.action?"positive":"secondary",testId:"scheduled-publish-trigger",className:i.cx(Q.statusTag,c)},s.action.toUpperCase()),o>1&&n.createElement(r.Paragraph,{className:Q.paragraph},"+ ",o-1," more"))},$=function(e){var t=e.job,i=e.children;return n.createElement(r.Tooltip,{place:"top",testId:t.sys.id,containerElement:"div",content:n.createElement(Z,{job:t,jobsCount:e.jobsCount})},i)},ee=function(e){var t=e.entityType,r=e.entityId,i=e.getEntityScheduledActions,s=e.children,o=n.useState({type:"loading"}),a=o[0],c=o[1];if(n.useEffect((function(){i(t,r).then((function(e){c({type:"loaded",jobs:e})})).catch((function(e){c({type:"error",error:e})}))}),[]),"loading"===a.type||"error"===a.type)return null;var l=a.jobs?a.jobs:[];return 0===l.length?null:n.createElement($,{job:l[0],jobsCount:l.length},s)};function te(e){return n.createElement("img",{alt:e.file.fileName,src:e.file.url+"?w=70&h=70&fit=thumb",height:70,width:70})}function ne(e,t){var n,r,i,s;switch(t.type){case"set_entry":return h({},e,{entries:h({},e.entries,(n={},n[t.id]=t.entry,n))});case"set_entry_failed":return h({},e,{entries:h({},e.entries,(r={},r[t.id]="failed",r))});case"set_asset":return h({},e,{assets:h({},e.assets,(i={},i[t.id]=t.asset,i))});case"set_asset_failed":return h({},e,{assets:h({},e.assets,(s={},s[t.id]="failed",s))});default:return e}}var re={entries:{},assets:{},scheduledActions:{}};function ie(e){var n=t.useReducer(ne,re),r=n[0],i=n[1],s=t.useCallback((function(t,n){var s=t+":"+n;return r.scheduledActions[s]?Promise.resolve(r.scheduledActions[s]):e.sdk.space.getEntityScheduledActions(t,n).then((function(e){return i({type:"set_scheduled_actions",key:s,actions:e}),e})).catch((function(){return i({type:"set_scheduled_actions",key:s,actions:void 0}),[]}))}),[e.sdk.space,r.scheduledActions]),o=t.useCallback((function(t){return e.sdk.space.getEntry(t).then((function(e){return i({type:"set_entry",id:t,entry:e}),e})).catch((function(){i({type:"set_entry_failed",id:t})}))}),[e.sdk.space]),a=t.useCallback((function(t){return e.sdk.space.getAsset(t).then((function(e){return i({type:"set_asset",id:t,asset:e}),e})).catch((function(){i({type:"set_asset_failed",id:t})}))}),[e.sdk.space]),c=t.useCallback((function(e){return r.assets[e]&&"failed"!==r.assets[e]?Promise.resolve(r.assets[e]):a(e)}),[r.assets,a]),l=t.useCallback((function(e){return r.entries[e]&&"failed"!==r.entries[e]?Promise.resolve(r.entries[e]):o(e)}),[r.entries,o]);return t.useEffect((function(){if(void 0!==e.sdk.space.onEntityChanged){var t=e.sdk.space.onEntityChanged,n=[];return Object.keys(r.entries).forEach((function(e){r.entries[e]&&"failed"!==r.entries.id&&n.push(t("Entry",e,(function(t){return i({type:"set_entry",id:e,entry:t})})))})),Object.keys(r.assets).forEach((function(e){r.assets[e]&&"failed"!==r.assets.id&&n.push(t("Asset",e,(function(t){return i({type:"set_asset",id:e,asset:t})})))})),function(){return n.forEach((function(e){return e()}))}}return e.sdk.navigator.onSlideInNavigation((function(e){e.oldSlideLevel>e.newSlideLevel&&(Object.keys(r.entries).map((function(e){r.entries[e]&&"failed"!==r.entries[e]&&o(e)})),Object.keys(r.assets).map((function(e){r.assets[e]&&"failed"!==r.assets[e]&&a(e)})))}))}),[e.sdk,r.assets,r.entries]),h({getOrLoadEntry:l,getOrLoadAsset:c,loadEntityScheduledActions:s},r)}var se=u(ie),oe=se[0],ae=se[1];function ce(e){return t.createElement(oe,{sdk:e.sdk},t.createElement(l.FieldConnector,{throttle:0,field:e.sdk.field,isInitiallyDisabled:e.isInitiallyDisabled,isEqualValues:function(e,t){return c(e,t)}},e.children))}ce.defaultProps={isInitiallyDisabled:!0,hasCardEditActions:!0};var le=function(){return Promise.resolve(!0)};function ue(e){var t;return{canPerformAction:e.can,canPerformActionOnEntryOfType:null!=(t=e.canPerformActionOnEntryOfType)?t:le}}function de(){return(de=v(z.mark((function e(t,n){var r;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Symbol(),e.next=3,Promise.all(t.map(function(){var e=v(z.mark((function e(t){return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:if(!e.sent){e.next=6;break}e.t0=t,e.next=7;break;case 6:e.t0=r;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",e.sent.filter((function(e){return e!==r})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){var n=e.sdk,r=e.entityType,i=e.parameters,s=t.useMemo((function(){return function(e){var t,n,r,i,s=[].concat(e.validations,null!=(t=null==(n=e.items)?void 0:n.validations)?t:[]),o=s.find((function(e){return"linkContentType"in e})),a=s.find((function(e){return"linkMimetypeGroup"in e})),c=s.find((function(e){return"size"in e})),l=c&&c.size||{},u=l.min,p=l.max,f=void 0;return d(u)&&d(p)?f={type:"min-max",min:u,max:p}:d(u)?f={type:"min",min:u,max:void 0}:d(p)&&(f={type:"max",max:p,min:void 0}),{contentTypes:null!=(r=null==o?void 0:o.linkContentType)?r:void 0,mimetypeGroups:null!=(i=null==a?void 0:a.linkMimetypeGroup)?i:void 0,numberOfLinks:f}}(e.sdk.field)}),[e.sdk.field]),o=t.useState(!0),a=o[0],c=o[1],l=t.useState(!0),u=l[0],p=l[1],f=function(e){var n=t.useMemo((function(){return"Asset"===e.entityType?[]:e.validations.contentTypes?e.allContentTypes.filter((function(t){var n;return null==(n=e.validations.contentTypes)?void 0:n.includes(t.sys.id)})):e.allContentTypes}),[e.allContentTypes,e.validations.contentTypes,e.entityType]),r=t.useState(n),i=r[0],s=r[1],o=t.useState(n),a=o[0],c=o[1],l=ue(e.sdk.access).canPerformActionOnEntryOfType;return t.useEffect((function(){function e(e){return function(e,t){return de.apply(this,arguments)}(n,(function(t){return l(e,t.sys.id)}))}function t(){return(t=v(z.mark((function t(){var n,r;return z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e("create");case 2:return n=t.sent,t.next=5,e("read");case 5:r=t.sent,s(n),c(r);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[n]),{creatableContentTypes:i,readableContentTypes:a,availableContentTypes:n}}(h({},e,{validations:s})),y=f.creatableContentTypes,m=f.readableContentTypes,g=f.availableContentTypes,E=ue(n.access).canPerformAction;return t.useEffect((function(){function e(){return(e=v(z.mark((function e(){return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Asset"!==r){e.next=5;break}return e.next=3,E("create","Asset");case 3:c(e.sent);case 5:"Entry"===r&&c(y.length>0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!1!==i.instance.showCreateEntityAction?function(){e.apply(this,arguments)}():c(!1)}),[r,i.instance,y]),t.useEffect((function(){function e(){return(e=v(z.mark((function e(){return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Asset"!==r){e.next=5;break}return e.next=3,E("read","Asset");case 3:p(e.sent);case 5:"Entry"===r&&p(m.length>0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!1!==i.instance.showLinkEntityAction?function(){e.apply(this,arguments)}():p(!1)}),[r,i.instance,m]),{canCreateEntity:a,canLinkEntity:u,creatableContentTypes:y,readableContentTypes:m,availableContentTypes:g,validations:s}}function fe(e){var n=e.setValue,r=e.entityType,i=pe(e),s=t.useCallback((function(e){n({sys:{type:"Link",linkType:r,id:e}})}),[n,r]),o=t.useCallback((function(e){n({sys:{type:"Link",linkType:r,id:e[0]}})}),[n,r]),a=J(h({},e,{canLinkMultiple:!1,editorPermissions:i,onCreate:s,onLink:o})),c=t.useCallback((function(t,n,r){return!!e.renderCustomCard&&e.renderCustomCard(t,a,r)}),[a]);return e.entityId?e.children(h({},e,{renderCustomCard:e.renderCustomCard&&c})):t.createElement(K,Object.assign({renderCustomActions:e.renderCustomActions},a))}function ye(e){var n=e.sdk.space.getCachedContentTypes();return t.createElement(ce,Object.assign({},e),(function(r){var i=r.value;return t.createElement(fe,Object.assign({},e,{key:r.externalReset+"-reference",entityId:i?i.sys.id:"",isDisabled:r.disabled,setValue:r.setValue,allContentTypes:n}))}))}ye.defaultProps={hasCardEditActions:!0};var me=l.entityHelpers.getEntryTitle,ve=l.entityHelpers.getEntityDescription,he=l.entityHelpers.getEntryStatus,ge=l.entityHelpers.getEntryImage,Ee={scheduleIcon:i.css({marginRight:s.spacing2Xs})};function be(e){var n,i=t.useState(null),s=i[0],o=i[1],a=e.contentType;t.useEffect((function(){e.entry&&ge({entry:e.entry,contentType:a,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode},e.getAsset).then((function(e){o(e)})).catch((function(){o(null)}))}),[e.entry,e.getAsset,a,e.localeCode,e.defaultLocaleCode]);var c=he(null==(n=e.entry)?void 0:n.sys);if("deleted"===c)return t.createElement(H,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove});var u=me({entry:e.entry,contentType:a,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),d=ve({entity:e.entry,contentType:a,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode});return t.createElement(r.EntryCard,{href:e.entryUrl,title:u,description:d,contentType:null==a?void 0:a.name,size:e.size,selected:e.isSelected,status:c,statusIcon:t.createElement(ee,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Entry",entityId:e.entry.sys.id},t.createElement(r.Icon,{className:Ee.scheduleIcon,icon:"Clock",size:"small",color:"muted",testId:"schedule-icon"})),thumbnailElement:s&&l.isValidImage(s)?t.createElement(te,{file:s}):null,cardDragHandleComponent:e.cardDragHandle,withDragHandle:!!e.cardDragHandle,dropdownListElements:e.onEdit||e.onRemove?t.createElement(t.Fragment,null,t.createElement(r.DropdownList,{onClick:function(e){e.stopPropagation()}},e.hasCardEditActions&&e.onEdit&&t.createElement(r.DropdownListItem,{onClick:function(){e.onEdit&&e.onEdit()},testId:"edit"},"Edit"),e.onRemove&&t.createElement(r.DropdownListItem,{onClick:function(){e.onRemove&&e.onRemove()},isDisabled:e.isDisabled,testId:"delete"},"Remove")),e.hasMoveOptions?t.createElement(r.DropdownList,{border:"top",onClick:function(e){e.stopPropagation()}},t.createElement(r.DropdownListItem,{onClick:function(){return e.onMoveTop&&e.onMoveTop()},isDisabled:!e.onMoveTop,testId:"move-top"},"Move to top"),t.createElement(r.DropdownListItem,{onClick:function(){return e.onMoveBottom&&e.onMoveBottom()},isDisabled:!e.onMoveBottom,testId:"move-bottom"},"Move to bottom")):t.createElement(t.Fragment,null)):void 0,onClick:function(t){t.preventDefault(),e.isClickable&&e.onEdit&&e.onEdit()}})}function Ce(e,t,n){return ke.apply(this,arguments)}function ke(){return(ke=v(z.mark((function e(t,n,r){var i;return z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.bulkEditing){e.next=11;break}return e.prev=1,e.next=4,t.navigator.openBulkEditor(t.entry.getSys().id,{fieldId:t.field.id,locale:t.field.locale,index:null!=(i=r.index)?i:0});case 4:return e.abrupt("return",e.sent.slide);case 9:e.prev=9,e.t0=e.catch(1);case 11:return e.next=13,t.navigator.openEntry(n,{slideIn:!0});case 13:return e.abrupt("return",e.sent.slide);case 16:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function we(e){var n=ae(),i=n.getOrLoadEntry,s=n.getOrLoadAsset,a=n.loadEntityScheduledActions,c=n.entries;t.useEffect((function(){i(e.entryId)}),[e.entryId]);var l="link"===e.viewType?"small":"default",u=c[e.entryId],d="failed"===u?"failed":void 0===u?"undefined":":"+u.sys.id+":"+u.sys.version,p=function(){var t=v(z.mark((function t(){var n;return z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ce(e.sdk,o(u,"sys.id"),{bulkEditing:e.parameters.instance.bulkEditing,index:e.index});case 2:n=t.sent,e.onAction&&e.onAction({entity:"Entry",type:"edit",id:o(u,"sys.id"),contentTypeId:o(u,"sys.contentType.sys.id"),slide:n});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),f=function(){e.onRemove(),e.onAction&&e.onAction({entity:"Entry",type:"delete",id:o(u,"sys.id"),contentTypeId:o(u,"sys.contentType.sys.id")})};return t.useEffect((function(){u&&e.onAction&&e.onAction({type:"rendered",entity:"Entry"})}),[u]),t.useMemo((function(){if("failed"===u){var n=t.createElement(H,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:f});return e.renderCustomMissingEntityCard?e.renderCustomMissingEntityCard({defaultCard:n,entity:{id:e.entryId,type:"Entry"}}):n}if(void 0===u)return t.createElement(r.EntryCard,{size:l,loading:!0});var i={index:e.index,entity:u,entityUrl:e.getEntityUrl&&e.getEntityUrl(u.sys.id),contentType:e.allContentTypes.find((function(e){return e.sys.id===u.sys.contentType.sys.id})),isDisabled:e.isDisabled,size:l,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,cardDragHandle:e.cardDragHandle,onEdit:p,onRemove:f,onMoveTop:e.onMoveTop,onMoveBottom:e.onMoveBottom},o=e.hasCardEditActions;function c(e){var n=h({},i,e,{hasCardEditActions:o,getAsset:s,getEntityScheduledActions:a,entry:(null==e?void 0:e.entity)||i.entity,entryUrl:(null==e?void 0:e.entityUrl)||i.entityUrl});return t.createElement(be,Object.assign({},n))}if(e.renderCustomCard){var d=e.renderCustomCard(i,{},c);if(!1!==d)return d}return c()}),[e,d])}function xe(e){return t.createElement(ye,Object.assign({},e,{entityType:"Entry"}),(function(n){var r=n.setValue;return t.createElement(we,Object.assign({},e,{allContentTypes:n.allContentTypes,isDisabled:n.isDisabled,entryId:n.entityId,renderCustomCard:n.renderCustomCard,hasCardEditActions:n.hasCardEditActions,onRemove:function(){r(null)}}))}))}function Te(e,t,n,r,i){void 0===i&&(i=n.length);var s=r.map((function(e){return{sys:{type:"Link",linkType:t,id:e}}})),o=Array.from(n);o.splice.apply(o,[i,0].concat(s)),e(o)}be.defaultProps={isClickable:!0,hasCardEditActions:!0,hasMoveOptions:!0},xe.defaultProps={isInitiallyDisabled:!0};var Le=[],Ie={sys:{id:"null-value"}};function De(e){var n=e.setValue,r=e.entityType,i=pe(e),s=t.useMemo((function(){return(e.items||[]).map((function(e){return e||Ie}))}),[e.items]),o=t.useCallback((function(e,t){return t.preventDefault()}),[]),a=t.useCallback((function(e){var t=p(s,e.oldIndex,e.newIndex);n(t)}),[s,n]),c=t.useCallback((function(e,t){var r=p(s,e,t);n(r)}),[s,n]),l=t.useCallback((function(e,t){return Te(n,r,s,[e],t)}),[n,s,r]),u=t.useCallback((function(e,t){return Te(n,r,s,e,t)}),[n,s,r]),d=J(h({},e,{canLinkMultiple:!0,editorPermissions:i,onCreate:l,onLink:u,itemsLength:s.length})),f=t.useCallback((function(t,n,r){return!!e.renderCustomCard&&e.renderCustomCard(t,d,r)}),[d]);return t.createElement(t.Fragment,null,e.children(h({},e,{onSortStart:o,onSortEnd:a,onMove:c,renderCustomCard:e.renderCustomCard&&f})),t.createElement(K,Object.assign({renderCustomActions:e.renderCustomActions},d)))}function Ae(e){var n=e.sdk.space.getCachedContentTypes();return t.createElement(ce,Object.assign({},e),(function(r){return t.createElement(De,Object.assign({},e,{items:r.value||Le,isDisabled:r.disabled,setValue:r.setValue,key:r.externalReset+"-list",allContentTypes:n}))}))}Ae.defaultProps={hasCardEditActions:!0};var Se={containter:i.css({position:"relative"}),item:i.css({marginBottom:s.spacingM})},Me=f.SortableHandle((function(){return n.createElement(r.CardDragHandle,null,"Reorder item")})),Oe=f.SortableElement((function(e){return n.createElement("div",{className:Se.item},e.children)})),Ne=f.SortableContainer((function(e){var t=e.items.length-1;return n.createElement("div",{className:Se.containter},e.items.map((function(r,i){return n.createElement(Oe,{disabled:e.isDisabled,key:r.sys.id+"-"+i,index:i},n.createElement(we,Object.assign({},e,{key:r.sys.id+"-"+i,index:i,allContentTypes:e.allContentTypes,isDisabled:e.isDisabled,entryId:r.sys.id,onRemove:function(){e.setValue(e.items.filter((function(e,t){return t!==i})))},onMoveTop:0!==i?function(){return e.onMove(i,0)}:void 0,onMoveBottom:i!==t?function(){return e.onMove(i,t)}:void 0,cardDragHandle:e.isDisabled?void 0:n.createElement(Me,null)})))})))})),Pe={cardDropdown:i.css({width:"300px"}),truncated:i.css({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"})};function Re(e){var t=e.entityFile,i=o(t,"fileName"),s=o(t,"contentType"),a=o(t,"details.size"),c=o(t,"details.image");return n.createElement(r.DropdownList,{border:"top",className:Pe.cardDropdown,onClick:function(e){e.stopPropagation()}},n.createElement(r.DropdownListItem,{isTitle:!0},"File info"),i&&n.createElement(r.DropdownListItem,null,n.createElement("div",{className:Pe.truncated},i)),s&&n.createElement(r.DropdownListItem,null,n.createElement("div",null,s)),a&&n.createElement(r.DropdownListItem,null,l.shortenStorageUnit(a,"B")),c&&n.createElement(r.DropdownListItem,null,c.width+" × "+c.height))}function je(e){var t=e.entityFile,i=e.isDisabled,s=e.onEdit,o=e.onRemove;return n.createElement(r.DropdownList,{className:Pe.cardDropdown,onClick:function(e){e.stopPropagation()}},n.createElement(r.DropdownListItem,{isTitle:!0},"Actions"),s&&n.createElement(r.DropdownListItem,{onClick:s,testId:"card-action-edit"},"Edit"),t&&n.createElement(r.DropdownListItem,{onClick:function(){"string"==typeof t.url&&window.open(t.url,"_blank","noopener,noreferrer")},testId:"card-action-download"},"Download"),o&&n.createElement(r.DropdownListItem,{isDisabled:i,onClick:o,testId:"card-action-remove"},"Remove"))}var _e={image:"image",video:"video",audio:"audio",richtext:"richtext",presentation:"presentation",spreadsheet:"spreadsheet",pdfdocument:"pdf",archive:"archive",plaintext:"plaintext",code:"code",markup:"markup"},He={scheduleIcon:i.css({marginRight:s.spacing2Xs})};function Fe(e){if(!e)return"archive";var t=y.getGroupLabel({type:e.contentType,fallbackFileName:e.fileName});return _e[t]||"archive"}var ze=function(e){var t=e.className,i=e.onEdit,s=e.getAssetUrl,o=e.onRemove,a=e.size,c=e.isDisabled,u=e.isSelected,d=e.isClickable,p=l.entityHelpers.getEntryStatus(e.asset.sys);if("deleted"===p)return n.createElement(H,{entityType:"Asset",asSquare:!0,isDisabled:e.isDisabled,onRemove:e.onRemove});var f=l.entityHelpers.getAssetTitle({asset:e.asset,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),y=e.asset.fields.file?e.asset.fields.file[e.localeCode]||e.asset.fields.file[e.defaultLocaleCode]:void 0;return n.createElement(r.AssetCard,{type:Fe(y),title:f,className:t,selected:u,href:s?s(e.asset.sys.id):void 0,status:p,statusIcon:n.createElement(ee,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Asset",entityId:e.asset.sys.id},n.createElement(r.Icon,{className:He.scheduleIcon,icon:"Clock",size:"small",color:"muted",testId:"schedule-icon"})),src:y&&y.url?"small"===a?y.url+"?w=150&h=150&fit=thumb":y.url+"?h=300":"",onClick:function(e){e.preventDefault(),d&&i&&i()},cardDragHandleComponent:e.cardDragHandle,withDragHandle:!!e.cardDragHandle,dropdownListElements:n.createElement(n.Fragment,null,je({entityFile:y,isDisabled:c,onEdit:i,onRemove:o}),y?Re({entityFile:y}):n.createElement("span",null)),size:a})};ze.defaultProps={isClickable:!0};var Be={scheduleIcon:i.css({marginRight:s.spacing2Xs})},Ye=function(e){var t=e.className,i=e.href,s=e.onEdit,o=e.onRemove,a=e.isDisabled,c=l.entityHelpers.getEntryStatus(e.asset.sys);if("deleted"===c)return n.createElement(H,{entityType:"Asset",isDisabled:e.isDisabled,onRemove:e.onRemove});var u=l.entityHelpers.getAssetTitle({asset:e.asset,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),d=e.asset.fields.file?e.asset.fields.file[e.localeCode]||e.asset.fields.file[e.defaultLocaleCode]:void 0;return n.createElement(r.EntryCard,{contentType:"Asset",title:u,className:t,href:i,size:"small",status:c,statusIcon:n.createElement(ee,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Asset",entityId:e.asset.sys.id},n.createElement(r.Icon,{className:Be.scheduleIcon,icon:"Clock",size:"small",color:"muted",testId:"schedule-icon"})),onClick:function(e){e.preventDefault(),s()},cardDragHandleComponent:e.cardDragHandle,withDragHandle:!!e.cardDragHandle,dropdownListElements:n.createElement(n.Fragment,null,je({entityFile:d,isDisabled:a,onEdit:s,onRemove:o}),d?Re({entityFile:d}):n.createElement("span",null))})};function qe(e){var n=ae(),i=n.getOrLoadAsset,s=n.loadEntityScheduledActions,o=n.assets;t.useEffect((function(){i(e.assetId)}),[e.assetId]);var a=o[e.assetId],c="failed"===a?"failed":void 0===a?"undefined":":"+a.sys.id+":"+a.sys.version;t.useEffect((function(){a&&e.onAction&&e.onAction({type:"rendered",entity:"Asset"})}),[a]);var l=function(){var t=v(z.mark((function t(){var n;return z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sdk.navigator.openAsset(e.assetId,{slideIn:!0});case 2:n=t.sent.slide,e.onAction&&e.onAction({entity:"Asset",type:"edit",id:e.assetId,contentTypeId:"",slide:n});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){e.onRemove(),e.onAction&&e.onAction({entity:"Asset",type:"delete",id:e.assetId,contentTypeId:""})};return t.useMemo((function(){if("failed"===a){var n=t.createElement(H,{entityType:"Asset",asSquare:"link"!==e.viewType,isDisabled:e.isDisabled,onRemove:u});return e.renderCustomMissingEntityCard?e.renderCustomMissingEntityCard({defaultCard:n,entity:{id:e.assetId,type:"Asset"}}):n}var i=e.getEntityUrl,o=e.sdk,c="big_card"===e.viewType?"default":"small",d={asset:a,entityUrl:i&&i(e.assetId),size:c,isDisabled:e.isDisabled,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,cardDragHandle:e.cardDragHandle,onEdit:l,onRemove:u};if("link"===e.viewType)return void 0===a?t.createElement(r.EntryCard,{size:"small",loading:!0}):t.createElement(Ye,Object.assign({},d,{href:d.entityUrl,getEntityScheduledActions:o.space.getEntityScheduledActions}));if(void 0===a)return t.createElement(r.AssetCard,{size:c,isLoading:!0,title:"",src:"",href:""});function p(e){var n=h({},d,e,{getEntityScheduledActions:s,asset:(null==e?void 0:e.entity)||d.asset,getAssetUrl:i});return t.createElement(ze,Object.assign({},n))}if(e.renderCustomCard){var f=h({},d,{entity:d.asset}),y=e.renderCustomCard(f,{},p);if(!1!==y)return y}return p()}),[e,c])}function Ue(e){return t.createElement(ye,Object.assign({},e,{entityType:"Asset"}),(function(n){var r=n.setValue;return t.createElement(qe,Object.assign({},e,{viewType:"big_card",assetId:n.entityId,isDisabled:n.isDisabled,onRemove:function(){r(null)}}))}))}Ue.defaultProps={isInitiallyDisabled:!0};var Ge={gridContainter:i.css({position:"relative",display:"flex",flexWrap:"wrap"}),container:i.css({position:"relative"}),item:i.css({marginBottom:s.spacingM,marginRight:s.spacingM})},Ve=f.SortableHandle((function(){return n.createElement(r.CardDragHandle,null,"Reorder item")})),We=f.SortableElement((function(e){return n.createElement("div",{className:Ge.item},e.children)})),Xe=f.SortableContainer((function(e){return n.createElement("div",{className:"card"===e.viewType?Ge.gridContainter:Ge.container},e.items.map((function(t,r){return n.createElement(We,{disabled:e.isDisabled,key:t.sys.id+"-"+r,index:r},n.createElement(qe,Object.assign({},e,{sdk:e.sdk,key:t.sys.id+"-"+r,assetId:t.sys.id,onRemove:function(){e.setValue(e.items.filter((function(e,t){return t!==r})))},cardDragHandle:e.isDisabled?void 0:n.createElement(Ve,null)})))})))}));function Je(e){return t.createElement(Ae,Object.assign({},e,{entityType:"Asset"}),(function(n){return t.createElement(Xe,Object.assign({},e,n,{axis:"card"===e.viewType?"xy":"y",useDragHandle:!0}))}))}Je.defaultProps={isInitiallyDisabled:!0},exports.AssetThumbnail=te,exports.CombinedLinkActions=function(e){return e.isFull?null:t.createElement("div",{className:"Asset"!==e.entityType||e.isEmpty?g:""},!e.canCreateEntity&&!e.canLinkEntity&&t.createElement(I,null),"Entry"===e.entityType&&t.createElement(N,Object.assign({},e)),"Asset"===e.entityType&&t.createElement(P,Object.assign({},e)))},exports.CreateEntryLinkButton=x,exports.CreateEntryMenuTrigger=C,exports.EntityProvider=oe,exports.MissingEntityCard=H,exports.MultipleEntryReferenceEditor=function(e){return t.createElement(Ae,Object.assign({},e,{entityType:"Entry"}),(function(n){return t.createElement(Ne,Object.assign({},e,n,{axis:"y",useDragHandle:!0}))}))},exports.MultipleMediaEditor=Je,exports.ScheduleTooltipContent=Z,exports.ScheduledIconWithTooltip=ee,exports.SingleEntryReferenceEditor=xe,exports.SingleMediaEditor=Ue,exports.WrappedAssetCard=ze,exports.WrappedEntryCard=be,exports.useEntities=ae;
//# sourceMappingURL=field-editor-reference.cjs.production.min.js.map
